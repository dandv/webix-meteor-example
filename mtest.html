<head>
  <title>mtest</title>
  <script type="text/javascript" src="http://cdn.webix.io/2.2/webix.js"></script>
  <link rel="stylesheet" type="text/css" href="http://cdn.webix.io/2.2/webix.css">

  <script type="text/javascript" src="webix-meteor.js"></script>
</head>

<body>

<script type="text/javascript">

	// ---
	//data CRUD
	// ---

	var proxy = webix.proxy("meteor", Books);

	var table = {
		view:"datatable",
		id:"dtable", select:true, multiselect:true,
		editable:true, editaction:"dblclick",
		columns:[{
			id:"name", editor:"text", fillspace:1
		},{
			id:"author", editor:"text", fillspace:1
		}],
		url: 	proxy,
		save:   proxy
	};

	var toolbar = {
		view:"toolbar",
		elements:[
			{ view:"label", label:"Dbl-Click to edit any row"},
			{ view:"button", value:"Add", width:100, click:function(){
				var row = $$("dtable").add({ name:"", author:"" });
				$$("dtable").editCell(row, "name")
			}},
			{ view:"button", value:"Remove", width:100, click:function(){
				var id = $$("dtable").getSelectedId();
				if (id)
					$$("dtable").remove(id);
				else
					webix.message("Please select any row first");
			}}
		]
	};



	// ---
	// templates
	// ---

	webix.protoUI({
		name:"reactive",
		$init:function(){
			this.$ready.push(this.render);
		},
		render:function(){
			this.$view.innerHTML="";
			if (this.config.data)
				UI.renderWithData(Template[this.config.template], this.config.data, this.$view);
			else
				UI.render(Template[this.config.template], this.$view);
		},
		setValue:function(data){
			this.config.data = data;
			this.render();
		}
	}, webix.ui.view, webix.BaseBind);


	//configure auto-updates for allinfo template
	Template.allinfo.helpers({
		books:function(){
			return Books.find();
		}
	});

	var templates = {
		cols:[
			{ header:"Webix Data Binding (select row in table)", body:{
				id:"t1", view:"reactive", template: "info" }
			},
			{ header:"Meteor Data Binding", body:{
				id:"t2", view:"reactive", template: "allinfo" }
			}
		]
	};

	webix.ui({
		rows:[toolbar, table, templates]
	});

	// show data in template when row selected in the datatable
	$$("t1").bind( $$("dtable") );

	</script>

</body>